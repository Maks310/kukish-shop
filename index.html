<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö–£–ö–Ü–® ‚Äî –ú–∞–≥–∞–∑–∏–Ω –∑–∞–ø—á–∞—Å—Ç–∏–Ω</title>
  <meta name="description" content="–ö–£–ö–Ü–® ‚Äî —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –∑–∞–ø—á–∞—Å—Ç–∏–Ω –¥–ª—è –±—ñ–∑–Ω–µ—Å—É: –∫–∞—Ç–∞–ª–æ–≥, —Ü—ñ–Ω–∏, –∫–æ–Ω—Ç–∞–∫—Ç–∏." />
  <link rel="stylesheet" href="./styles.css" />
  <!-- Open Graph –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —à–∞—Ä–∏–Ω–≥—É -->
  <meta property="og:title" content="–ö–£–ö–Ü–® ‚Äî –ú–∞–≥–∞–∑–∏–Ω –∑–∞–ø—á–∞—Å—Ç–∏–Ω" />
  <meta property="og:description" content="–ö–∞—Ç–∞–ª–æ–≥ –∞–≤—Ç–æ–∑–∞–ø—á–∞—Å—Ç–∏–Ω –¥–ª—è –±—ñ–∑–Ω–µ—Å—É." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/" />
</head>
<body>
  <header class="header">
    <div class="brand">
      <div class="logo">–ö</div>
      <div class="title">
        <strong>–ö–£–ö–Ü–®</strong>
        <small>–Ü–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –∑–∞–ø—á–∞—Å—Ç–∏–Ω</small>
      </div>
    </div>
    <div class="search">
      <input id="q" placeholder="–ü–æ—à—É–∫: –Ω–∞–∑–≤–∞, –±—Ä–µ–Ω–¥, –∞—Ä—Ç–∏–∫—É–ª‚Ä¶" />
      <select id="filterCategory">
        <option value="">–í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó</option>
        <option>–î–≤–∏–≥—É–Ω</option>
        <option>–ö—É–∑–æ–≤</option>
        <option>–ì–∞–ª—å–º–∞</option>
        <option>–ü—ñ–¥–≤—ñ—Å–∫–∞</option>
        <option>–ï–ª–µ–∫—Ç—Ä–∏–∫–∞</option>
        <option>–Ü–Ω—à–µ</option>
      </select>
      <select id="filterCondition">
        <option value="">–°—Ç–∞–Ω: –≤—Å—ñ</option>
        <option>–ù–æ–≤–∏–π</option>
        <option>–ë/–≤</option>
      </select>
      <button id="btnSearch">–ü–æ—à—É–∫</button>
      <button id="btnClear" class="ghost">–°–∫–∏–Ω—É—Ç–∏</button>
    </div>
    <nav class="nav">
      <a href="/admin/" class="admin-link" title="–ê–¥–º—ñ–Ω–∫–∞ (—Ç—ñ–ª—å–∫–∏ –≤–ª–∞—Å–Ω–∏–∫)">–ê–¥–º—ñ–Ω</a>
    </nav>
  </header>

  <main class="wrap">
    <section id="notice" class="notice hidden"></section>
    <section id="list" class="grid"></section>
  </main>

  <footer class="footer">
    <div>
      <strong>–ö–£–ö–Ü–®</strong> ¬∑ <span id="footerText">–ú–∞–≥–∞–∑–∏–Ω –∑–∞–ø—á–∞—Å—Ç–∏–Ω –¥–ª—è –±—ñ–∑–Ω–µ—Å—É</span>
      <div class="muted">–ö–æ–Ω—Ç–∞–∫—Ç–∏: <span id="contactInfo">‚Äî</span></div>
    </div>
  </footer>

  <script>
    // üëâ –ó–ê–ú–Ü–ù–ò–¢–ò –Ω–∞ –≤–∞—à—ñ –∑–Ω–∞—á–µ–Ω–Ω—è
    const GH_OWNER = "Maks310";   // –≤–∞—à GitHub –ª–æ–≥—ñ–Ω
    const GH_REPO  = "kukish-shop"; // –Ω–∞–∑–≤–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é
    const GH_BRANCH = "main";      // –≥—ñ–ª–∫–∞

    const apiList = `https://api.github.com/repos/${GH_OWNER}/${GH_REPO}/contents/products?ref=${GH_BRANCH}`;
    const rawBase = `https://raw.githubusercontent.com/${GH_OWNER}/${GH_REPO}/${GH_BRANCH}`;

    const q = document.getElementById('q');
    const filterCategory = document.getElementById('filterCategory');
    const filterCondition = document.getElementById('filterCondition');
    const btnSearch = document.getElementById('btnSearch');
    const btnClear = document.getElementById('btnClear');
    const list = document.getElementById('list');
    const notice = document.getElementById('notice');
    const contactInfo = document.getElementById('contactInfo');
    const footerText = document.getElementById('footerText');

    let PRODUCTS = [];

    btnSearch.addEventListener('click', render);
    btnClear.addEventListener('click', () => { q.value=''; filterCategory.value=''; filterCondition.value=''; render(); });
    [q, filterCategory, filterCondition].forEach(el=> el.addEventListener('input', render));

    main();

    async function main(){
      await loadSettings();
      await loadProducts();
      render();
    }

    async function loadSettings(){
      try{
        const res = await fetch(`${rawBase}/site/settings.json`);
        if(res.ok){
          const s = await res.json();
          contactInfo.textContent = s.contact || '‚Äî';
          footerText.textContent = s.footer || '–ú–∞–≥–∞–∑–∏–Ω –∑–∞–ø—á–∞—Å—Ç–∏–Ω –¥–ª—è –±—ñ–∑–Ω–µ—Å—É';
        }
      }catch(e){ console.warn('settings error', e); }
    }

    async function loadProducts(){
      try{
        const res = await fetch(apiList);
        if(!res.ok) throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª—ñ–≤');
        const files = await res.json();
        const jsonFiles = files.filter(f=>/\.json$/i.test(f.name));
        const loaded = await Promise.all(jsonFiles.map(async f=>{
          const r = await fetch(`${rawBase}/products/${f.name}`);
          if(!r.ok) return null;
          try{ return await r.json(); }catch{ return null; }
        }));
        PRODUCTS = loaded.filter(Boolean).filter(x=> x.published !== false);
      }catch(err){
        showNotice('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é/–≥—ñ–ª–∫–∏.', true);
        console.error(err);
      }
    }

    function render(){
      list.innerHTML='';
      hideNotice();
      let items = [...PRODUCTS];
      const qv = (q.value||'').toLowerCase().trim();
      if(filterCategory.value) items = items.filter(x=>x.category===filterCategory.value);
      if(filterCondition.value) items = items.filter(x=>x.condition===filterCondition.value);
      if(qv){ items = items.filter(x=> [x.title,x.brand,x.sku,x.desc].join(' ').toLowerCase().includes(qv)); }

      if(items.length===0){
        showNotice('–ù–µ–º–∞—î –æ–≥–æ–ª–æ—à–µ–Ω—å –∑–∞ –≤–∞—à–∏–º –∑–∞–ø–∏—Ç–æ–º. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∏ –∞–±–æ –ø–æ—à—É–∫.');
        return;
      }

      for(const it of items){
        const card = document.createElement('article');
        card.className = 'card';
        card.innerHTML = `
          <img src="${it.image||''}" alt="${escapeHtml(it.title||'–ó–∞–ø—á–∞—Å—Ç–∏–Ω–∞')}" onerror="this.style.display='none'"/>
          <h3>${escapeHtml(it.title||'–ë–µ–∑ –Ω–∞–∑–≤–∏')}</h3>
          <div class="muted">${escapeHtml([it.brand, it.desc].filter(Boolean).join(' ¬∑ '))}</div>
          <div class="row">
            <span class="tag">${escapeHtml(it.category||'-')}</span>
            <span class="tag">${escapeHtml(it.condition||'-')}</span>
            <span class="tag">${it.sku? 'SKU: '+escapeHtml(it.sku): 'SKU: ‚Äî'}</span>
          </div>
          <div class="row between">
            <div class="price">${fmtPrice(it.price)}</div>
            <button class="ghost" onclick="contact()">–ó–≤'—è–∑–∞—Ç–∏—Å—è</button>
          </div>`;
        list.appendChild(card);
      }
    }

    function contact(){
      const c = contactInfo.textContent.trim();
      if(!c || c==='‚Äî'){ alert('–ö–æ–Ω—Ç–∞–∫—Ç–∏ –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ. –í–∫–∞–∂—ñ—Ç—å —ó—Ö —É /admin (Site Settings).'); return; }
      if(c.startsWith('http')) window.open(c, '_blank');
      else if(c.startsWith('+')) window.location.href = 'tel:'+c;
      else if(c.startsWith('@')) window.open('https://t.me/'+c.replace('@',''), '_blank');
      else alert('–ö–æ–Ω—Ç–∞–∫—Ç–∏: '+c);
    }

    function fmtPrice(p){
      if(p===undefined || p===null || p==='') return '‚Äî';
      const n = Number(p);
      return (Number.isFinite(n)? n.toLocaleString('uk-UA') : String(p)) + ' –≥—Ä–Ω';
    }

    function showNotice(msg, danger=false){
      notice.textContent = msg; notice.classList.remove('hidden');
      notice.classList.toggle('danger', !!danger);
    }
    function hideNotice(){ notice.classList.add('hidden'); }

    function escapeHtml(s=''){
      return s.replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
    }
  </script>
</body>
</html>
